version: "3"
output: "prefixed"
tasks:
  start-rabbitmq:
    desc: Start rabbitmq server with management studio
    cmd: devbox services up rabbitmq rabbitmq-logs enable_rabbitmq_management create_queues --process-compose-file ./libs/async-api/process-compose.yaml
  initial-build:
    desc: Generate go client code for asyncapi.yaml (if main.go isn't found)
    preconditions:
      - sh: '[ ! -f "main.go" ]'
    cmd: asyncapi generate fromTemplate ./asyncapi.yaml  @asyncapi/go-watermill-template --force-write -p moduleName=slek-link/asyncapi -o .
  build:
    desc: Generate go client code for asyncapi.yaml
    cmd: asyncapi generate fromTemplate ./asyncapi.yaml  @asyncapi/go-watermill-template --force-write -p moduleName=slek-link/asyncapi -o .
